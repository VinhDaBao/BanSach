<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title
	th:text="${sach != null and sach.id != null ? 'Ch·ªânh s·ª≠a s√°ch' : 'Th√™m m·ªõi s√°ch'}">Qu·∫£n
	l√Ω s√°ch</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
	rel="stylesheet">
<style>
body {
	background-color: #f8f9fa;
	display: flex;
	flex-direction: column;
	min-height: 100vh;
}

main {
	flex: 1;
	display: flex;
	justify-content: center;
	align-items: flex-start;
	padding: 40px 0;
}

.content-container {
	width: 90%;
	max-width: 800px;
}

footer {
	background-color: #212529;
	color: white;
	text-align: center;
	padding: 12px 0;
	margin-top: auto;
}
</style>
</head>
<body>

	<!-- Navbar -->
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
		<div class="container-fluid">
			<a class="navbar-brand" href="/admin/dashboard"><i
				class="bi bi-book-fill me-2"></i> Bookstore Admin</a>
			<button class="navbar-toggler" type="button"
				data-bs-toggle="collapse" data-bs-target="#navbarNav">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ms-auto">
					<li class="nav-item"><a class="nav-link active"
						href="/admin/dashboard"><i class="bi bi-person-circle me-1"></i>
							Admin</a></li>
					<li class="nav-item"><a class="nav-link" href="/logout">ƒêƒÉng
							Xu·∫•t</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<main>
		<div class="content-container">
			<div class="card shadow-sm">
				<div class="card-header bg-primary text-white">
					<h5
						th:text="${sach != null and sach.id != null ? '‚úèÔ∏è Ch·ªânh s·ª≠a s√°ch' : '‚ûï Th√™m m·ªõi s√°ch'}"></h5>
				</div>

				<div class="card-body">
					<form th:action="@{/admin/sach/save}" th:object="${sach}"
						method="post" enctype="multipart/form-data">
						<input type="hidden" th:field="*{id}" />

						<div class="row">
							<div class="col-md-6 mb-3">
								<label class="form-label fw-bold">T√™n s√°ch</label> <input
									type="text" th:field="*{tenSP}" class="form-control"
									placeholder="Nh·∫≠p t√™n s√°ch" required>
							</div>

							<div class="col-md-6 mb-3">
								<label class="form-label fw-bold">T√°c gi·∫£</label> <input
									type="text" th:field="*{tacGia}" class="form-control"
									placeholder="Nh·∫≠p t√™n t√°c gi·∫£" required>
							</div>

							<div class="col-md-6 mb-3">
								<label class="form-label fw-bold">Gi√° b√°n (‚Ç´)</label> <input
									type="number" th:field="*{giaBan}" step="0.01" min="0"
									class="form-control" placeholder="Nh·∫≠p gi√° b√°n" required>
							</div>

							<div class="col-md-6 mb-3">
								<label class="form-label fw-bold">S·ªë l∆∞·ª£ng t·ªìn</label> <input
									type="number" th:value="${sach.soLuongTon}"
									class="form-control" readonly disabled> <small
									class="text-muted">(*) S·ªë l∆∞·ª£ng t·ªìn ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª±
									ƒë·ªông khi nh·∫≠p / b√°n h√†ng.</small>
							</div>

							<div class="col-md-6 mb-3">
								<label class="form-label fw-bold">NƒÉm xu·∫•t b·∫£n</label> <input
									type="number" th:field="*{namXB}" min="1900" max="2100"
									class="form-control" required>
							</div>

							<div class="col-md-6 mb-3">
								<label class="form-label fw-bold">S·ªë trang</label> <input
									type="number" th:field="*{soTrang}" min="1"
									class="form-control">
							</div>
						</div>

						<label class="form-label fw-bold">Nh√† xu·∫•t b·∫£n</label> <select
							id="nxbSelect" name="nxbId" class="form-select" required>
							<option value="">-- Ch·ªçn nh√† xu·∫•t b·∫£n --</option>
							<option th:each="nxb : ${dsNXB}" th:value="${nxb.id}"
								th:text="${nxb.tenNXB}"
								th:selected="${sach.nhaXB != null and sach.nhaXB.id == nxb.id}">
							</option>
							<option value="__other__">+ Nh·∫≠p m·ªõi...</option>
						</select>

						<div id="newNxbFields" class="mt-2 d-none">
							<input type="text" name="tenNXB" class="form-control mb-2"
								placeholder="T√™n Nh√† Xu·∫•t B·∫£n" /> <input type="text"
								name="diaChiNXB" class="form-control mb-2" placeholder="ƒê·ªãa ch·ªâ" />
							<input type="number" name="namThanhLapNXB" class="form-control"
								placeholder="NƒÉm th√†nh l·∫≠p" min="1800" max="2100" />
						</div>

						<script>
document.getElementById('nxbSelect').addEventListener('change', function() {
    const newFields = document.getElementById('newNxbFields');
    if (this.value === '__other__') {
        newFields.classList.remove('d-none');
        document.querySelectorAll('#newNxbFields input').forEach(i => i.required = true);
    } else {
        newFields.classList.add('d-none');
        document.querySelectorAll('#newNxbFields input').forEach(i => i.required = false);
    }
});
</script>
						<!-- H√¨nh th·ª©c -->
						<div class="mb-3">
							<label class="form-label fw-bold">H√¨nh th·ª©c</label> <select
								name="hinhThucId" class="form-select" required>
								<option value="">-- Ch·ªçn h√¨nh th·ª©c --</option>
								<option th:each="ht : ${dsHT}" th:value="${ht.id}"
									th:text="${ht.tenHT}"></option>
								<option value="__other__">+ Nh·∫≠p m·ªõi...</option>
							</select>

							<div id="newHtField" class="mt-2 d-none">
								<input type="text" name="tenHTMoi" class="form-control"
									placeholder="T√™n h√¨nh th·ª©c m·ªõi">
							</div>
						</div>

						<script>
							document
									.addEventListener(
											'DOMContentLoaded',
											function() {
												const htSelect = document
														.querySelector('select[name="hinhThucId"]');
												const newHtField = document
														.getElementById('newHtField');

												htSelect
														.addEventListener(
																'change',
																function() {
																	if (this.value === '__other__') {
																		newHtField.classList
																				.remove('d-none');
																		newHtField
																				.querySelector('input[name="tenHTMoi"]').required = true;
																	} else {
																		newHtField.classList
																				.add('d-none');
																		newHtField
																				.querySelector('input[name="tenHTMoi"]').required = false;
																	}
																});
											});
						</script>

						<!-- Th·ªÉ lo·∫°i -->
						<div class="mb-3">
							<label class="form-label fw-bold">Th·ªÉ lo·∫°i</label>
							<div class="row">
								<!-- Danh s√°ch th·ªÉ lo·∫°i c√≥ s·∫µn -->
								<div class="col-md-6" th:each="tl : ${dsTheLoai}">
									<div class="form-check">
										<input class="form-check-input" type="checkbox"
											name="theLoaiIds" th:value="${tl.id}"
											th:checked="${sach.danhSachTheLoai != null and #lists.contains(sach.danhSachTheLoai, tl)}">
										<label class="form-check-label" th:text="${tl.tenTL}"></label>
									</div>
								</div>

								<!-- Th√™m th·ªÉ lo·∫°i m·ªõi -->
								<div class="mt-3">
									<input type="text" name="tenTheLoaiMoi" class="form-control"
										placeholder="+ Nh·∫≠p th·ªÉ lo·∫°i m·ªõi (n·∫øu ch∆∞a c√≥)">
								</div>
							</div>
						</div>

						<!-- ·∫¢nh -->
						<div class="mb-3">
							<label class="form-label fw-bold">·∫¢nh minh h·ªça</label> <input
								type="file" name="anhFile" class="form-control">
							<div class="mt-2" th:if="${sach != null and sach.anh != null}">
								<img th:src="@{${sach.anh}}" alt="·∫¢nh s√°ch"
									style="max-height: 100px;" class="img-thumbnail">
							</div>
						</div>

						<div class="mb-3">
							<label class="form-label fw-bold">M√¥ t·∫£</label>
							<textarea th:field="*{moTa}" class="form-control" rows="3"
								placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ s√°ch"></textarea>
						</div>

						<div class="mb-3">
							<label class="form-label fw-bold">Ng√†y c√≥ h√†ng</label> <input
								type="datetime-local" th:field="*{ngayCoHang}"
								class="form-control" required>
						</div>

						<div class="mb-3">
							<label class="form-label fw-bold">Tr·∫°ng th√°i</label> <select
								th:field="*{trangThai}" class="form-select" required>
								<option value="">-- Ch·ªçn tr·∫°ng th√°i --</option>
								<option th:value="true" th:selected="${sach.trangThai == true}">ƒêang
									kinh doanh</option>
								<option th:value="false"
									th:selected="${sach.trangThai == false}">Ng·ª´ng kinh
									doanh</option>
							</select>
						</div>

						<div class="d-flex justify-content-between">
							<a th:href="@{/admin/sach}" class="btn btn-secondary">‚¨Ö Quay
								l·∫°i</a>
							<button type="submit" class="btn btn-success">üíæ L∆∞u</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</main>

	<footer>¬© 2025 Bookstore Admin</footer>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
