<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quản Lý Đơn Hàng - Bookstore Admin</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
	rel="stylesheet">
<style>
body {
	background-color: #f8f9fa;
}

.sidebar {
	background-color: #ffffff;
	border-right: 1px solid #dee2e6;
}
</style>
</head>
<body>

	<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
		<div class="container-fluid">
			<a class="navbar-brand" href="/admin/dashboard"><i
				class="bi bi-book-fill me-2"></i> Bookstore Admin</a>
			<button class="navbar-toggler" type="button"
				data-bs-toggle="collapse" data-bs-target="#navbarNav"
				aria-controls="navbarNav" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav me-auto"></ul>
				<ul class="navbar-nav ms-auto">
					<li class="nav-item"><a class="nav-link"
						href="/admin/dashboard"><i class="bi bi-person-circle me-1"></i>
							Admin</a></li>
					<li class="nav-item"><a class="nav-link" href="/logout">Đăng
							Xuất</a></li>
				</ul>
			</div>
		</div>
	</nav>


	<div class="container-fluid mt-2">
		<!-- Giảm margin top -->
		<div class="row">
			<!-- Sidebar -->
			<nav class="col-md-3 col-lg-2 bg-white sidebar p-2">

				<ul class="nav flex-column">
					<li class="nav-item"><a class="nav-link"
						href="/admin/dashboard"><i class="bi bi-speedometer2 me-2"></i>
							Dashboard</a></li>
					<li class="nav-item"><a class="nav-link" href="/admin/sach"><i
							class="bi bi-bookshelf me-2"></i> Quản Lý Sách</a></li>
					<li class="nav-item"><a class="nav-link" href="/admin/ncc"><i
							class="bi bi-bookshelf me-2"></i> Quản Lý Nhà Cung Cấp</a></li>
					<li class="nav-item"><a class="nav-link active"
						href="/admin/orders"><i class="bi bi-cart-check me-2"></i>
							Quản Lý Đơn Hàng</a></li>
					<li class="nav-item"><a class="nav-link" href="/admin/users"><i
							class="bi bi-people me-2"></i> Quản Lý Khách Hàng</a></li>
					<li class="nav-item"><a class="nav-link"
						href="/admin/promotion/promotion-list"><i
							class="bi bi-tags me-2"></i> Quản Lý Khuyến Mãi</a></li>
					<li class="nav-item"><a class="nav-link" href="/admin/tonkho"><i
							class="bi bi-box-seam me-2"></i> Quản Lý Tồn Kho</a></li>
					<li class="nav-item"><a class="nav-link active"
						href="/admin/danhgia"><i class="bi bi-chat-dots me-2"></i>
							Quản Lý Đánh Giá</a></li>
					<li class="nav-item"><a class="nav-link" href="/admin/thongke"><i
							class="bi bi-bar-chart-line me-2"></i> Thống Kê</a></li>
				</ul>
			</nav>

			<main class="col-md-9 col-lg-10 px-3">
				<div
					class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
					<h1 class="h2">
						<i class="bi bi-cart-check me-2"></i> Quản Lý Đơn Hàng
					</h1>
					<div class="btn-group">
						<form th:action="@{/admin/orders}" method="get">
							<select name="trangThai" class="form-select"
								onchange="this.form.submit()">
								<option value="all" th:selected="${selectedStatus == 'all'}">Tất
									cả trạng thái</option>
								<option th:each="status : ${statuses}" th:value="${status}"
									th:text="${status}" th:selected="${selectedStatus == status}">
								</option>
							</select>
						</form>
					</div>

				</div>

				<!-- Alert messages -->
				<div th:if="${success}"
					class="alert alert-success alert-dismissible fade show"
					role="alert">
					<span th:text="${success}">Đã cập nhật thành công!</span>
					<button type="button" class="btn-close" data-bs-dismiss="alert"
						aria-label="Close"></button>
				</div>
				<div th:if="${error}"
					class="alert alert-danger alert-dismissible fade show" role="alert">
					<span th:text="${error}">Có lỗi xảy ra!</span>
					<button type="button" class="btn-close" data-bs-dismiss="alert"
						aria-label="Close"></button>
				</div>

				<div class="table-responsive">
					<table class="table table-striped">
						<thead>
							<tr>
								<th>ID Đơn</th>
								<th>Khách Hàng</th>
								<th>Tổng Tiền</th>
								<th>Trạng Thái</th>
								<th>Ngày Đặt</th>
								<th>Hành Động</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="order : ${orders.content}">
								<td th:text="'#' + ${order.id}">#001</td>
								<td th:text="${order.nguoiDung.hoTen}">Nguyễn Văn A</td>
								<td
									th:text="${#numbers.formatDecimal(order.tongTien, 0, 'POINT', 0, 'COMMA')} + ' ₫'"></td>
								<td><span class="badge bg-warning"
									th:if="${order.trangThai == 'Chờ xác nhận'}">Chờ xác
										nhận</span> <span class="badge bg-success"
									th:if="${order.trangThai == 'Đã xác nhận'}">Đã xác nhận</span>
									<span class="badge bg-danger"
									th:if="${order.trangThai == 'Đã hủy'}">Đã hủy</span></td>
								<td
									th:text="${#temporals.format(order.ngayDat, 'dd/MM/yyyy HH:mm')}"></td>
								<td>
									<form
										th:action="@{/admin/orders/{id}/update-status(id=${order.id})}"
										method="post" class="d-inline">
										<select name="newStatus"
											class="form-select form-select-sm d-inline-block"
											style="width: auto;">
											<option value="Chờ xác nhận"
												th:selected="${order.trangThai == 'Chờ xác nhận'}">Chờ
												xác nhận</option>
											<option value="Đã xác nhận"
												th:selected="${order.trangThai == 'Đã xác nhận'}">Đã
												xác nhận</option>
											<option value="Đã hủy"
												th:selected="${order.trangThai == 'Đã hủy'}">Đã hủy</option>
										</select>
										<button type="submit" class="btn btn-sm btn-secondary">Cập
											nhật</button>
										<a th:href="@{/admin/orders/{id}/detail(id=${order.id})}"
											class="btn btn-sm btn-primary ms-1">Xem chi tiết</a>
									</form>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

				<!-- Phân trang -->
				<nav aria-label="Page navigation">
					<ul class="pagination justify-content-center mt-3">
						<!-- Nút Trước -->
						<li class="page-item"
							th:classappend="${orders.first} ? 'disabled'"><a
							class="page-link"
							th:href="@{/admin/orders(page=${orders.number - 1}, trangThai=${selectedStatus})}">
								« </a></li>

						<!-- Các trang -->
						<li class="page-item"
							th:each="i : ${#numbers.sequence(0, orders.totalPages - 1)}"
							th:classappend="${i == orders.number} ? 'active'"><a
							class="page-link" th:text="${i + 1}"
							th:href="@{/admin/orders(page=${i}, trangThai=${selectedStatus})}">
						</a></li>

						<!-- Nút Sau -->
						<li class="page-item" th:classappend="${orders.last} ? 'disabled'">
							<a class="page-link"
							th:href="@{/admin/orders(page=${orders.number + 1}, trangThai=${selectedStatus})}">
								»</a>
						</li>
					</ul>
				</nav>
			</main>
		</div>
	</div>


	<footer class="bg-dark text-white text-center py-3 mt-auto"> ©
		2025 Bookstore Admin </footer>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script>
        function filterOrders() {
            const status = document.getElementById('statusFilter').value;
            const url = new URL(window.location);
            if (status) {
                url.searchParams.set('trangThai', status);
            } else {
                url.searchParams.delete('trangThai');
            }
            window.location.href = url.toString();
        }

        // Auto-hide alerts after 5 seconds
        setTimeout(function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
    </script>
</body>
</html>