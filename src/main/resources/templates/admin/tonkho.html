<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quản Lý Tồn Kho - Bookstore Admin</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
	rel="stylesheet">

<style>
body {
	background-color: #f8f9fa;
}

.sidebar {
	background-color: #ffffff;
	border-right: 1px solid #dee2e6;
}

.filter-bar {
	background: #fff;
	border-radius: 8px;
	padding: 0.5rem 1rem;
	display: flex;
	justify-content: space-between;
	align-items: center;
	flex-wrap: wrap;
	gap: 0.5rem;
	margin-bottom: 0.5rem;
}

.filter-bar input, .filter-bar select {
	max-width: 220px;
}

.table-container {
	background: #fff;
	border-radius: 8px;
	padding: 0.75rem;
}

h1 {
	color: #333;
	margin-bottom: 20px;
}

table {
	background-color: white;
	box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
}

thead {
	background-color: #198754;
	color: white;
}

th, td {
	vertical-align: middle;
}

tr:hover {
	background-color: #f8f9fa;
}
/* trạng thái */
.very-low-stock {
	background-color: #f8d7da !important;
}

.low-stock {
	background-color: #fff3cd !important;
}

.normal-stock {
	background-color: #d1e7dd !important;
}

.badge-status {
	font-size: 0.85rem;
	padding: 6px 12px;
	border-radius: 20px;
}

.bg-danger {
	background-color: #dc3545 !important;
}

.bg-warning {
	background-color: #ffc107 !important;
	color: #000;
}

.bg-success {
	background-color: #198754 !important;
}

.filter-bar {
	display: flex;
	flex-wrap: wrap;
	gap: 10px;
	margin-bottom: 15px;
}

.filter-bar input, .filter-bar select {
	max-width: 250px;
}

.pagination .page-item.active .page-link {
	background-color: #198754;
	border-color: #198754;
}

.btn-outline-primary {
	min-width: 180px;
	text-align: center;
}

.btn-sm {
	padding: 4px 10px;
	font-size: 0.875rem;
}
</style>
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
		<div class="container-fluid">
			<a class="navbar-brand" href="/admin/dashboard"><i
				class="bi bi-book-fill me-2"></i> Bookstore Admin</a>
			<button class="navbar-toggler" type="button"
				data-bs-toggle="collapse" data-bs-target="#navbarNav"
				aria-controls="navbarNav" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav me-auto"></ul>
				<ul class="navbar-nav ms-auto">
					<li class="nav-item"><a class="nav-link"
						href="/admin/dashboard"><i class="bi bi-person-circle me-1"></i>
							Admin</a></li>
					<li class="nav-item"><a class="nav-link" href="/logout">Đăng
							Xuất</a></li>
				</ul>
			</div>
		</div>
	</nav>


	<div class="container-fluid mt-2">
		<!-- Giảm margin top -->
		<div class="row">
			<!-- Sidebar -->
			<nav class="col-md-3 col-lg-2 bg-white sidebar p-2">

				<ul class="nav flex-column">
					<li class="nav-item"><a class="nav-link"
						href="/admin/dashboard"><i class="bi bi-speedometer2 me-2"></i>
							Dashboard</a></li>
					<li class="nav-item"><a class="nav-link" href="/admin/sach"><i
							class="bi bi-bookshelf me-2"></i> Quản Lý Sách</a></li>
					<li class="nav-item"><a class="nav-link" href="/admin/ncc"><i
							class="bi bi-bookshelf me-2"></i> Quản Lý Nhà Cung Cấp</a></li>
					<li class="nav-item"><a class="nav-link active"
						href="/admin/orders"><i class="bi bi-cart-check me-2"></i>
							Quản Lý Đơn Hàng</a></li>
					<li class="nav-item"><a class="nav-link" href="/admin/users"><i
							class="bi bi-people me-2"></i> Quản Lý Khách Hàng</a></li>
					<li class="nav-item"><a class="nav-link"
						href="/admin/promotion/promotion-list"><i
							class="bi bi-tags me-2"></i> Quản Lý Khuyến Mãi</a></li>
					<li class="nav-item"><a class="nav-link" href="/admin/tonkho"><i
							class="bi bi-box-seam me-2"></i> Quản Lý Tồn Kho</a></li>
					<li class="nav-item"><a class="nav-link" href="/admin/thongke"><i
							class="bi bi-bar-chart-line me-2"></i> Thống Kê</a></li>
				</ul>
			</nav>

			<main class="col-md-9 col-lg-10 px-3">
				<div
					class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
					<h1 class="h2">
						<i class="bi bi-box-seam me-2"></i> Quản Lý Tồn Kho
					</h1>

				</div>

				<!-- Bộ lọc -->
				<form th:action="@{/admin/tonkho}" method="get"
					class="filter-bar bg-light p-3 rounded shadow-sm d-flex flex-wrap justify-content-between align-items-center gap-3">

					<!-- Ô tìm kiếm -->
					<div class="d-flex align-items-center gap-2 flex-grow-1">
						<input type="text" name="search"
							class="form-control form-control-sm" style="max-width: 300px;"
							placeholder="Tìm theo tên, thể loại..." th:value="${search}">
						<button type="submit" class="btn btn-success btn-sm px-3">
							<i class="bi bi-search"></i> Tìm
						</button>
					</div>

					<!-- Bộ lọc trạng thái -->
					<div class="d-flex align-items-center gap-2">
						<select name="status" class="form-select form-select-sm">
							<option value="">-- Trạng thái --</option>
							<option value="Ổn định"
								th:selected="${selectedStatus == 'Ổn định'}">Ổn định</option>
							<option value="Thấp" th:selected="${selectedStatus == 'Thấp'}">Thấp</option>
							<option value="Sắp hết"
								th:selected="${selectedStatus == 'Sắp hết'}">Sắp hết</option>
						</select>
						<button type="submit"
							class="btn btn-primary btn-sm d-flex align-items-center gap-1 px-3">
							<i class="bi bi-funnel"></i> <span>Lọc</span>
						</button>
					</div>

					<!-- Nút làm mới -->
					<a th:href="@{/admin/tonkho}"
						class="btn btn-warning btn-sm text-white fw-bold px-3"> <i
						class="bi bi-arrow-clockwise"></i> Làm mới
					</a>
				</form>

				<!-- Bảng dữ liệu -->
				<div class="table-responsive">
					<table class="table table-bordered table-hover align-middle">
						<thead>
							<tr>
								<th>Mã</th>
								<th>Tên Sản Phẩm</th>
								<th>Tác Giả</th>
								<th>Thể Loại</th>
								<th>Nhà Xuất Bản</th>
								<th>Giá</th>
								<th>SL Nhập</th>
								<th>SL Bán</th>
								<th>Còn Lại</th>
								<th>Ngày Nhập</th>
								<th>Trạng Thái</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="item : ${stockReport}"
								th:classappend="${item['canhBao'] == 'Sắp hết' ? 'very-low-stock' :
                                     (item['canhBao'] == 'Thấp' ? 'low-stock' : 'normal-stock')}">
								<td th:text="${item['id']}"></td>
								<td th:text="${item['tenSP']}"></td>
								<td th:text="${item['tacGia']}"></td>
								<td th:text="${item['theLoai']}"></td>
								<td th:text="${item['nhaXuatBan']}"></td>
								<td th:text="${#numbers.formatDecimal(item['gia'], 0, 2)}"></td>


								<td th:text="${item['soLuongNhap']}"></td>
								<td th:text="${item['soLuongBan']}"></td>
								<td th:text="${item['conLai']}"></td>
								<td th:text="${#dates.format(item['ngayNhap'], 'dd/MM/yyyy')}"></td>
								<td><span class="badge badge-status"
									th:text="${item['canhBao']}"
									th:classappend="${item['canhBao'] == 'Sắp hết' ? ' bg-danger' :
                                              (item['canhBao'] == 'Thấp' ? ' bg-warning' :
                                              (item['canhBao'] == 'Ổn định' ? ' bg-success' : ''))}">
								</span></td>
							</tr>
						</tbody>
					</table>
				</div>

				<!-- Phân trang -->
				<nav th:if="${totalPages > 1}">
					<ul class="pagination justify-content-center">
						<li class="page-item"
							th:classappend="${currentPage == 1} ? 'disabled'"><a
							class="page-link"
							th:href="@{/admin/tonkho(page=${currentPage-1}, search=${search}, status=${selectedStatus})}">«</a>
						</li>
						<li class="page-item"
							th:each="i : ${#numbers.sequence(1, totalPages)}"
							th:classappend="${i == currentPage} ? 'active'"><a
							class="page-link" th:text="${i}"
							th:href="@{/admin/tonkho(page=${i}, search=${search}, status=${selectedStatus})}"></a>
						</li>
						<li class="page-item"
							th:classappend="${currentPage == totalPages} ? 'disabled'"><a
							class="page-link"
							th:href="@{/admin/tonkho(page=${currentPage+1}, search=${search}, status=${selectedStatus})}">»</a>
						</li>
					</ul>
				</nav>
			</main>
			<footer class="bg-dark text-white text-center py-3 mt-4"> ©
				2025 Bookstore Admin </footer>
</body>
</html>
