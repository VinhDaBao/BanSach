<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Bookstore</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fa; }
        .sidebar { background-color: #ffffff; border-right: 1px solid #dee2e6; }
    </style>
</head>
<body>
  
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="/admin/dashboard"><i class="bi bi-book-fill me-2"></i> Bookstore Admin</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto"></ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="/admin/dashboard"><i class="bi bi-person-circle me-1"></i> Admin</a></li>
                    <li class="nav-item"><a class="nav-link" href="/logout">Đăng Xuất</a></li>
                </ul>
            </div>
        </div>
    </nav>

   
    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-4 col-lg-3 bg-white sidebar p-3">  
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link active" href="/admin/dashboard"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin/sach"><i class="bi bi-bookshelf me-2"></i> Quản Lý Sách</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin/ncc"><i class="bi bi-bookshelf me-2"></i> Quản Lý Nhà Cung Cấp</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin/orders"><i class="bi bi-cart-check me-2"></i> Quản Lý Đơn Hàng</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin/users"><i class="bi bi-people me-2"></i> Quản Lý Khách Hàng</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin/promotion/promotion-list"><i class="bi bi-tags me-2"></i> Quản Lý Khuyến Mãi</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin/thongke"><i class="bi bi-bar-chart-line me-2"></i> Thống Kê</a></li>
                </ul>
            </nav>

         
            <main class="col-md-8 ms-sm-auto col-lg-9 px-md-4">
                <!-- Page Header với Filter Thời Gian -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2"><i class="bi bi-speedometer2 me-2"></i> Dashboard Quản Lý Cửa Hàng Sách</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary"><i class="bi bi-arrow-clockwise"></i> Làm mới dữ liệu</button>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="timeFilter" data-bs-toggle="dropdown">
                                Hôm nay
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="timeFilter">
                                <li><a class="dropdown-item" href="#">Hôm nay</a></li>
                                <li><a class="dropdown-item" href="#">Tuần này</a></li>
                                <li><a class="dropdown-item" href="#">Tháng này</a></li>
                                <li><a class="dropdown-item" href="#">Năm nay</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

              
                <div class="row mb-4">
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-primary text-white shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="card-title">Tổng Số Sách</h5>
                                        <h3 class="card-text" th:text="${totalBooks}">150</h3>
                                    </div>
                                    <i class="bi bi-bookshelf fs-1 opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-warning text-white shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="card-title">Đơn Hàng Mới</h5>
                                        <h3 class="card-text" th:text="${newOrders}">20</h3>
                                    </div>
                                    <i class="bi bi-cart-check fs-1 opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-success text-white shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="card-title">Doanh Thu Hôm Nay</h5>
                                        <h3 class="card-text" th:text="${dailyRevenue}">5.000.000 ₫</h3>
                                    </div>
                                    <i class="bi bi-currency-exchange fs-1 opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-info text-white shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="card-title">Khách Hàng Đăng Ký</h5>
                                        <h3 class="card-text" th:text="${registeredUsers}">500</h3>
                                    </div>
                                    <i class="bi bi-people fs-1 opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                
                <div class="card mb-4 shadow-sm">
                    <div class="card-header">Báo Cáo Tồn Kho</div>
                    <div class="card-body">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Sách</th>
                                    <th>Số Lượng Còn</th>
                                    <th>Đã Bán</th>
                                    <th>Cảnh Báo</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item : ${stockReport}">
                                    <td th:text="${item.tenSP}">Sách A</td>
                                    <td th:text="${item.soLuongTon}">50</td>
                                    <td th:text="${item.daBan}">100</td>
                                    <td>
                                        <span class="badge bg-danger" th:if="${item.soLuongTon < 10}">Sắp Hết</span>
                                        <span class="badge bg-warning" th:if="${item.soLuongTon >= 10 and item.soLuongTon < 50}">Thấp</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

               
                <div class="row mb-4">
                    <div class="col-xl-6">
                        <div class="card shadow-sm">
                            <div class="card-header">
                                <h5><i class="bi bi-bar-chart-line me-2"></i> Biểu Đồ Doanh Thu (Tháng Này)</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="revenueChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-6">
                        <div class="card shadow-sm">
                            <div class="card-header">
                                <h5><i class="bi bi-graph-up me-2"></i> Biểu Đồ Sách Bán Chạy</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="topBooksChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Sách Bán Chạy -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header">
                        <h5><i class="bi bi-star-fill me-2"></i> Top Sách Bán Chạy</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center" th:each="book : ${topSellingBooks}">
                                <span th:text="${book.tenSP} + ' (' + ${book.tacGia} + ')'">Sách A (Tác giả X)</span>
                                <span class="badge bg-success rounded-pill" th:text="${book.soLuongBan} + ' bản'">100 bản</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Đơn Hàng Gần Đây -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header">
                        <h5><i class="bi bi-list-check me-2"></i> Đơn Hàng Gần Đây</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID Đơn</th>
                                        <th>Khách Hàng</th>
                                        <th>Tổng Tiền</th>
                                        <th>Trạng Thái</th>
                                        <th>Ngày Đặt</th>
                                        <th>Hành Động</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="order : ${recentOrders}">
                                        <td th:text="'#' + ${order.id}"> #001</td>
                                        <td th:text="${order.nguoiDung.hoTen}">Nguyễn Văn A</td>
                                        <td th:text="${order.tongTien} + ' ₫'">1.200.000 ₫</td>
                                        <td><span class="badge bg-warning" th:if="${order.trangThai == 'Đang xử lý'}">Đang Xử Lý</span>
                                            <span class="badge bg-success" th:if="${order.trangThai == 'Đã giao'}">Hoàn Thành</span></td>
                                        <td th:text="${#temporals.format(order.ngayDat, 'dd/MM/yyyy')}">25/09/2025</td>
                                        <td><a href="#" class="btn btn-sm btn-primary">Xem Chi Tiết</a></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            
                <div class="card shadow-sm mb-4">
                    <div class="card-header">
                        <h5><i class="bi bi-chat-dots me-2"></i> Đánh Giá Gần Đây</h5>
                    </div>
                    <div class="card-body">
                        <div class="list-group">
                            <a href="#" class="list-group-item list-group-item-action" th:each="review : ${recentReviews}">
                                <div class="d-flex w-100 justify-content-between">
                                    <h5 class="mb-1" th:text="${review.sach.tenSP} + ' - ' + ${review.soSao} + ' Sao'">Sách A - 5 Sao</h5>
                                    <small th:text="${#temporals.format(review.ngayTao, 'HH:mm')} + ' giờ trước'">1 giờ trước</small>
                                </div>
                                <p class="mb-1" th:text="${review.noiDung}"> "Sách hay, giao hàng nhanh!" - Khách C</p>
                                <button class="btn btn-sm btn-outline-primary">Trả Lời</button>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div class="card shadow-sm">
                    <div class="card-header">Khuyến Mãi Đang Chạy</div>
                    <div class="card-body">
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between" th:each="promo : ${activePromotions}">
                                <span th:text="${promo.tenKM}">Giảm 10% Sách Mới</span>
                                <a href="/admin/promotion/promotion-list" class="btn btn-sm btn-outline-secondary">Quản Lý</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3 mt-4">
        © 2025 Bookstore Admin
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            const revenueData = /*[[${revenueChartData}]]*/ {};
            new Chart(revenueCtx, {
                type: 'line',
                data: revenueData,
                options: {
                    responsive: true,
                    scales: { y: { beginAtZero: true } }
                }
            });

            
            const topBooksCtx = document.getElementById('topBooksChart').getContext('2d');
            const topBooksData = /*[[${topBooksChartData}]]*/ {};
            new Chart(topBooksCtx, {
                type: 'bar',
                data: topBooksData,
                options: { 
                    responsive: true,
                    scales: { y: { beginAtZero: true } } 
                }
            });
        });
    </script>
</body>
</html>