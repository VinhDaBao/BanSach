<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thống Kê - Bookstore Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fa; }
        .sidebar { background-color: #ffffff; border-right: 1px solid #dee2e6; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="/admin/dashboard"><i class="bi bi-book-fill me-2"></i> Bookstore Admin</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto"></ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/admin/dashboard"><i class="bi bi-person-circle me-1"></i> Admin</a></li>
                    <li class="nav-item"><a class="nav-link" href="/logout">Đăng Xuất</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <nav class="col-md-4 col-lg-3 bg-white sidebar p-3">  
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="/admin/dashboard"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin/sach"><i class="bi bi-bookshelf me-2"></i> Quản Lý Sách</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin/ncc"><i class="bi bi-bookshelf me-2"></i> Quản Lý Nhà Cung Cấp</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin/orders"><i class="bi bi-cart-check me-2"></i> Quản Lý Đơn Hàng</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin/users"><i class="bi bi-people me-2"></i> Quản Lý Khách Hàng</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin/promotion/promotion-list"><i class="bi bi-tags me-2"></i> Quản Lý Khuyến Mãi</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/admin/thongke"><i class="bi bi-bar-chart-line me-2"></i> Thống Kê</a></li>
                </ul>
            </nav>

            <main class="col-md-8 ms-sm-auto col-lg-9 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2"><i class="bi bi-bar-chart-line me-2"></i> Thống Kê Chi Tiết</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary"><i class="bi bi-arrow-clockwise"></i> Làm mới dữ liệu</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary"><i class="bi bi-file-earmark-arrow-down"></i> Xuất Báo Cáo (PDF/Excel)</button>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="timeFilter" data-bs-toggle="dropdown">
                                Tháng này
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="timeFilter">
                                <li><a class="dropdown-item" href="#">Hôm nay</a></li>
                                <li><a class="dropdown-item" href="#">Tuần này</a></li>
                                <li><a class="dropdown-item" href="#">Tháng này</a></li>
                                <li><a class="dropdown-item" href="#">Năm nay</a></li>
                                <li><a class="dropdown-item" href="#">Tùy chỉnh...</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-primary text-white shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="card-title">Tổng Doanh Thu</h5>
                                        <h3 class="card-text" th:text="${totalRevenue}">150.000.000 ₫</h3>
                                    </div>
                                    <i class="bi bi-currency-exchange fs-1 opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-success text-white shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="card-title">Tổng Đơn Hàng</h5>
                                        <h3 class="card-text" th:text="${totalOrders}">500</h3>
                                    </div>
                                    <i class="bi bi-cart-check fs-1 opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-info text-white shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="card-title">Sách Bán Chạy Nhất</h5>
                                        <h3 class="card-text" th:text="${topSellingBook}">Sách A</h3>
                                    </div>
                                    <i class="bi bi-book fs-1 opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-warning text-white shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="card-title">Khách Hàng Mới</h5>
                                        <h3 class="card-text" th:text="${newCustomers}">100</h3>
                                    </div>
                                    <i class="bi bi-person-plus fs-1 opacity-50"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-xl-6">
                        <div class="card shadow-sm">
                            <div class="card-header">
                                <h5><i class="bi bi-graph-up me-2"></i> Doanh Thu Theo Thời Gian</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="revenueOverTimeChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-6">
                        <div class="card shadow-sm">
                            <div class="card-header">
                                <h5><i class="bi bi-pie-chart me-2"></i> Phân Bổ Doanh Thu Theo Danh Mục</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="categoryRevenueChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-xl-6">
                        <div class="card shadow-sm">
                            <div class="card-header">
                                <h5><i class="bi bi-star-fill me-2"></i> Top 10 Sách Bán Chạy</h5>
                            </div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between align-items-center" th:each="book : ${top10Books}">
                                        <span th:text="${book.tenSP}">Sách A</span>
                                        <span class="badge bg-success rounded-pill" th:text="${book.soLuongBan} + ' bản'">100 bản</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-6">
                        <div class="card shadow-sm">
                            <div class="card-header">
                                <h5><i class="bi bi-graph-up-arrow me-2"></i> Tăng Trưởng Khách Hàng</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="customerGrowthChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4 shadow-sm">
                    <div class="card-header">Báo Cáo Tồn Kho Chi Tiết</div>
                    <div class="card-body">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Sách</th>
                                    <th>Số Lượng Nhập</th>
                                    <th>Số Lượng Bán</th>
                                    <th>Còn Lại</th>
                                    <th>Giá Trị Tồn Kho</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item : ${detailedStockReport}">
                                    <td th:text="${item.tenSP}">Sách A</td>
                                    <td th:text="${item.soLuongNhap}">200</td>
                                    <td th:text="${item.soLuongBan}">150</td>
                                    <td th:text="${item.conLai}">50</td>
                                    <td th:text="${item.giaTriTonKho} + ' ₫'">2.500.000 ₫</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card shadow-sm">
                    <div class="card-header">Thống Kê Đơn Hàng Theo Trạng Thái</div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3" th:each="entry : ${orderStatusStats}">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h5 th:text="${entry.key}">Đã giao</h5>
                                        <h3 class="text-primary" th:text="${entry.value}">100</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-3 mt-4">
        © 2025 Bookstore Admin
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const revenueOverTimeCtx = document.getElementById('revenueOverTimeChart').getContext('2d');
            const revenueOverTimeData = /*[[${revenueOverTimeData}]]*/ {};
            new Chart(revenueOverTimeCtx, {
                type: 'line',
                data: revenueOverTimeData,
                options: { responsive: true, scales: { y: { beginAtZero: true } } }
            });

            const categoryRevenueCtx = document.getElementById('categoryRevenueChart').getContext('2d');
            const categoryRevenueData = /*[[${categoryRevenueData}]]*/ {};
            new Chart(categoryRevenueCtx, {
                type: 'doughnut',
                data: categoryRevenueData,
                options: { responsive: true }
            });

            const customerGrowthCtx = document.getElementById('customerGrowthChart').getContext('2d');
            const customerGrowthData = /*[[${customerGrowthData}]]*/ {};
            new Chart(customerGrowthCtx, {
                type: 'line',
                data: customerGrowthData,
                options: { responsive: true, scales: { y: { beginAtZero: true } } }
            });
        });
    </script>
</body>
</html>